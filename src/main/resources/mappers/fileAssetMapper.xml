<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.dreamstart.mapper.FileAssetMapper">

	<resultMap type="FileAssetDTO" id="fileMap">
		<id property="fileId" column="file_id" />
		<result property="ownerType" column="owner_type" />
		<result property="ownerId" column="owner_id" />
		<result property="originalName" column="original_name" />
		<result property="storedPath" column="stored_path" />
		<result property="mimeType" column="mime_type" />
		<result property="sizeBytes" column="size_bytes" />
		<result property="createdAt" column="created_at" />
		<result property="uuid" column="uuid" />
	</resultMap>

	<select id="list" resultMap="fileMap">
		select
		`file_id`, `owner_type`,
		`owner_id`, `original_name`,
		`stored_path`, `mime_type`, `size_bytes`,
		`created_at`, `uuid`
		from `file_asset`
		where `owner_type` = #{ownerType}
		and `owner_id`= #{ownerId}
	</select>

	<select id="select" resultMap="fileMap">
		select
		`file_id`, `owner_type`,
		`owner_id`, `original_name`,
		`stored_path`, `mime_type`, `size_bytes`,
		`created_at`, `uuid`
		from `file_asset`
		where `owner_type` = #{ownerType}
		and `owner_id` = #{ownerId}
		order by `file_id` asc
		limit 1
	</select>


	<insert id="insertFileInfo" parameterType="FileAssetDTO"
		useGeneratedKeys="true" keyProperty="fileId">
		insert into `file_asset`
		(`original_name`, `stored_path`,
		`mime_type`, `size_bytes`,
		`created_at`, `uuid`) values
		(#{originalName}, #{storedPath}, #{mimeType}, #{sizeBytes},
		now(), #{uuid})
	</insert>

	<update id="insertFileOwner">
		update `file_asset` set `owner_type` = #{ownerType}, `owner_id` = #{ownerId}  where `file_id` = #{fileId}
	</update>

	<update id="update">

	</update>

	<delete id="deleteByOwner">
		delete from `file_asset` where `owner_type` =
		#{ownerType} and `owner_id` = #{ownerId}
	</delete>

	<delete id="delete">
		delete from `file_asset` where `file_id` = #{fileId}
	</delete>

</mapper>
