<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.dreamstart.mapper.EventMapper">
 	<resultMap type="EventDTO" id="eventMap">
 		<id column="event_id" property="eventId" />
 		<result column="title" property="title" />
 		<result column="description" property="description" />
 		<result column="location" property="location" />
 		<result column="start_date" property="startDate" />
 		<result column="end_date" property="endDate" />
 		<result column="capacity" property="capacity" />
 		<result column="status" property="status" />
 		<result column="visibility" property="visibility" />
 		<result column="poster_url" property="posterUrl" />
 		<result column="created_by" property="createdBy" />
 		<result column="created_at" property="createdAt" />
 		<result column="updated_at" property="updatedAt" />
 		<result column="is_paid" property="isPaid"/>
 		<result column="price" property="price"/>
 		<result column="currency" property="currency"/>
 		<result column="category" property="category"/>
 	</resultMap>

	<!-- 이벤트 페이징 -->
	<select id="list" resultMap="eventMap">
		select * from `event` 
		order by `event_id` DESC
		limit #{cri.pageStart},#{cri.perPageNum}
	</select>
	
	<!-- 드롭다운용 : 이벤트 전체조회 -->
	<select id="eventAll" resultMap="eventMap">
		select
			`event_id`, `title`, `start_date`, `end_date`
		from `event`
		order by `start_date` desc
	</select>
	
	<!-- 신규등록 -->
	<insert id="insert" parameterType="EventDTO"
			useGeneratedKeys="true" keyProperty="eventId" keyColumn="event_id">
		insert into event_erp.`event`
			(`title`, `description`, `location`, `start_date`, `end_date`, 
			`capacity`, `status`, `visibility`, `poster_url`, `created_by`, 
			`created_at`, `updated_at`, `is_paid`, `price`, `currency`, `category`)
		values
			(#{title}, #{description}, #{location}, 
			<!-- datetime_local -> DATETIME 변환 -->
			STR_TO_DATE(#{start_date}, '%Y-%m-%dT%H:%i'),
			STR_TO_DATE(#{end_date}, '%Y-%m-%dT%H:%i'),
			#{capacity}, #{status}, #{visible}, #{posterUrl},
			#{createBy}, NOW(), NOW(),
			#{isPaid}, #{price}, #{currency}, #{category})
	</insert>
	
	<select id="selectByEventId" resultMap="eventMap">
	select * from `event` where `event_id` = #{eventId}
	</select>
</mapper>
